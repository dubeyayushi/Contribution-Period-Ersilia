# Model: eos30gr - Deep hERG Blocker Classification

## Overview

This repository contains code and data related to the hERG blocker classification model eos30gr provided by Ersilia. The model predicts the probability that a molecule is a hERG blocker, with training based on 7889 compounds with experimental data (% of hERG inhibition).

## Model Information

- Model ID: eos30gr
- Slug: deepherg
- Task: Classification
- Input: Compound (SMILES)
- Output: Probability of hERG Blockade (Float)

## Tasks - Outreachy Contribution Period

- [x] T1 Model bias (i.e: models giving very high values or low values): to check that, we only need to run predictions for a list of 1000 diverse molecules in each model and plot the results in a scatter plot.

- [x] T2 Reproducibility: can we reproduce the exact values / a figure / that authors obtained when training the model in the first place? This means we need to read the publication and identify for example a compound identified using that model and check that we obtain the same values.

- [x] T3 Performance: can we check if the model gives accurate results in external datasets? This is more time consuming and will be done by identifying a public dataset that has not been used in model training, and running predictions to build AUROC curves - to simplify reports, we will only focus on AUROC or R2 as metrics now.

## Steps to Reproduce

### 1. Install Ersilia Model Hub

Use this [link](https://ersilia.gitbook.io/ersilia-book/ersilia-model-hub/installation) to install Ersilia Model Hub on your system

### 2. Download Model and Run

#### For Task T1:

Use the following commands to download and run the model on your system. 

```
ersilia -v fetch eos30gr
ersilia serve eos30gr
ersilia -v api run -i data/input_data.csv -o data/output_data.csv
```

#### For Task T2:

Use the following commands to download and run the model on your system. 

```
ersilia -v fetch eos30gr
ersilia serve eos30gr
ersilia -v api run -i data/input_task2.csv -o data/output_task2.csv
```

#### For Task T3:

Use the following commands to download and run the model on your system. 

```
ersilia -v fetch eos30gr
ersilia serve eos30gr
ersilia -v api run -i data/input_task3.csv -o data/output_task3.csv
```

### 3. Explore the Results

- **For Task T1:** Open the Jupyter notebook notebooks/00_model_bias_eos30gr.ipynb for detailed analysis and visualizations.
- **For Task T2:** Open the Jupyter notebook notebooks/01_model_reproducibility_eos30gr.ipynb for detailed analysis and visualizations.
- **For Task T3:** Open the Jupyter notebook notebooks/02_external_validation_eos30gr.ipynb for detailed analysis and visualizations.

## About the Dataset

- **For Task T1:** The model was run on the dataset downloaded from ChEMBL in TSV format which was preprocessed to meet the model's requirements. The downloaded dataset containing 8715 entries can be viewed from `data/raw_data.tsv`.
- **For Task T2:** The model was run on the dataset used by the authors in their [publication](https://acrobat.adobe.com/id/urn:aaid:sc:ap:3cca2c36-6b4f-478a-996c-7f77423e819e?viewer%21megaVerb=group-discover). The dataset was downloaded from the [repository](https://github.com/ChengF-Lab/deephERG) made by the authors. The dataset can be viewed from `data/input_task2.csv`. It contains the detailed prediction results for 1,824 FDA-approved small molecule drugs available from the DrugBank database.
- **For Task T3:** The model was run on the dataset used by Li et al in their [publication](https://acrobat.adobe.com/id/urn:aaid:sc:ap:01ce6a64-01b1-4369-a583-84e1c8da5015). The dataset can be downloaded using this [link](https://ochem.eu/login/show.do?render-mode=full). The dataset contains 1092 records in which 234 records are hERG blockers and the rest are non-blockers.

_Note that all the input and output files used in the tasks are present in the `data` directory of this repository. If you wish to run the model on other inputs, follow [this guide](https://ersilia.gitbook.io/ersilia-book/ersilia-model-hub/inputs)_

## Results

### Task T1:

- The notebook `00_model_bias_eos30gr.ipynb` provides insights into the model's predictions for 1000 molecules, including visualizations highlighting key findings.
- Major percentage of the dataset has a very low probability of being a hERG bloakade. And around 1.1% molecules have the probability of being a hERG blockade. This suggests that:
  - Either the model is biased towards predicting the molecule as not being a hERG blocker, or
  - The selected dataset is unbalanced and contains only few molecules which are hERG blockers.
 
### Task T2:

- The notebook `01_model_reproducibility_eos30gr.ipynb` provides insights about the model reproducibility by running the model on the dataset used by the authors.
- From the analysis, it was concluded that the output results generated by the model from Ersilia Model Hub does not match the results of the publication. Therefore, we can say that the model eos30gr is not reproducible.

### Task T3:

- The notebook `02_external_validation_eos30gr.ipynb` provides insights about whether the model can be validated on an external dataset.
- From the analysis, it was concluded that the output results generated by the model from Ersilia Model Hub does not validate the experimental values in the external dataset. Therefore, we can say that the model eos30gr cannot be validated on the external dataset chosen.

## References

- [Ersilia GitHub Repository](https://github.com/ersilia-os/ersilia)
- [Ersilia GitBook](https://ersilia.gitbook.io/ersilia-book)
- [Model Publication](https://acrobat.adobe.com/id/urn:aaid:sc:ap:3cca2c36-6b4f-478a-996c-7f77423e819e)
- [Model GitHub Repository](https://github.com/ersilia-os/eos30gr)
- [Model Source Code](https://github.com/ChengF-Lab/deephERG)
- [Publication for Task 3 Dataset](https://acrobat.adobe.com/id/urn:aaid:sc:ap:01ce6a64-01b1-4369-a583-84e1c8da5015)
- [External Dataset for Task 3](https://ochem.eu/login/show.do?render-mode=full) -> testing and validation data


